<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enduro Coach</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
    <style>
        :root {
            --bg: #F4F5F7;
            --surface: #FFFFFF;
            --border: #E8EAED;
            --text: #1A1D23;
            --text-secondary: #5F6570;
            --text-muted: #9EA3AC;
            --accent: #FC4C02;
            --accent-dark: #D93E00;
            --blue: #1A73E8;
            --blue-light: #EBF2FD;
            --blue-dark: #1557B0;
            --fresh: #059669;
            --fresh-bg: #ECFDF5;
            --fresh-text: #065F46;
            --neutral-clr: #D97706;
            --neutral-bg: #FFFBEB;
            --neutral-text: #92400E;
            --fatigued: #DC2626;
            --fatigued-bg: #FEF2F2;
            --fatigued-text: #991B1B;
            --radius-lg: 16px;
            --radius-md: 10px;
            --radius-sm: 8px;
            --shadow-sm: 0 1px 4px rgba(0,0,0,.05), 0 1px 2px rgba(0,0,0,.04);
            --shadow-md: 0 4px 16px rgba(0,0,0,.08), 0 1px 4px rgba(0,0,0,.04);
            --topbar-h: 62px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh;
        }

        /* ---- Topbar ---- */
        .topbar {
            position: sticky; top: 0; z-index: 100;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            height: var(--topbar-h);
            display: flex; align-items: center;
            padding: 0 28px;
            gap: 16px;
            box-shadow: 0 1px 6px rgba(0,0,0,.06);
        }
        .topbar-brand { display: flex; align-items: center; gap: 12px; flex: 1; }
        .brand-icon {
            width: 34px; height: 34px;
            background: var(--accent);
            border-radius: 9px;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 800; color: #fff; letter-spacing: -0.5px;
        }
        .brand-name { font-size: 16px; font-weight: 700; letter-spacing: -0.3px; }
        .topbar-right { display: flex; align-items: center; gap: 12px; }
        .strava-status { display: flex; align-items: center; gap: 7px; font-size: 13px; color: var(--text-secondary); }
        .dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .dot.connected { background: var(--fresh); box-shadow: 0 0 0 3px var(--fresh-bg); }
        .dot.disconnected { background: #D1D5DB; }
        .btn-connect {
            background: var(--accent); color: #fff;
            padding: 8px 18px; border-radius: var(--radius-sm);
            text-decoration: none; font-size: 13px; font-weight: 600;
            transition: background .15s, transform .1s;
            display: inline-block; white-space: nowrap;
        }
        .btn-connect:hover { background: var(--accent-dark); transform: translateY(-1px); }
        .btn-disconnect {
            font-size: 12px; color: var(--text-muted); text-decoration: none;
            padding: 4px 10px; border-radius: var(--radius-sm);
            transition: color .15s, background .15s;
        }
        .btn-disconnect:hover { color: var(--fatigued); background: var(--fatigued-bg); }

        /* ---- Welcome hero ---- */
        .welcome-hero {
            display: flex; flex-direction: column; align-items: center;
            text-align: center;
            padding: 80px 24px 60px;
            max-width: 560px; margin: 0 auto;
        }
        .welcome-icon {
            width: 64px; height: 64px;
            background: var(--accent); border-radius: 18px;
            display: flex; align-items: center; justify-content: center;
            font-size: 22px; font-weight: 900; color: #fff;
            letter-spacing: -0.5px; margin-bottom: 28px;
            box-shadow: 0 8px 24px rgba(252,76,2,.2);
        }
        .welcome-title {
            font-size: 32px; font-weight: 900; letter-spacing: -1px;
            margin-bottom: 12px; line-height: 1.15;
        }
        .welcome-sub {
            font-size: 15px; color: var(--text-secondary);
            line-height: 1.7; margin-bottom: 32px;
        }
        .welcome-cta {
            display: inline-flex; align-items: center; gap: 10px;
            background: var(--accent); color: #fff;
            padding: 14px 32px; border-radius: var(--radius-sm);
            text-decoration: none; font-size: 16px; font-weight: 700;
            transition: background .15s, transform .1s, box-shadow .15s;
            box-shadow: 0 4px 14px rgba(252,76,2,.25);
        }
        .welcome-cta:hover {
            background: var(--accent-dark); transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(252,76,2,.35);
        }
        .welcome-note {
            font-size: 13px; color: var(--text-muted);
            background: var(--bg); border: 1px solid var(--border);
            border-radius: var(--radius-sm); padding: 14px 18px;
            line-height: 1.6;
        }
        .welcome-note code {
            font-size: 12px; background: #E8EAED; padding: 2px 6px;
            border-radius: 4px; font-family: "SF Mono", Consolas, monospace;
        }
        .welcome-features {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 12px; margin-top: 40px; text-align: left; width: 100%;
        }
        .wf {
            display: flex; align-items: center; gap: 10px;
            font-size: 13px; color: var(--text-secondary);
            padding: 10px 14px;
            background: var(--surface); border: 1px solid var(--border);
            border-radius: var(--radius-sm);
        }
        .wf-icon { font-size: 16px; flex-shrink: 0; }
        @media (max-width: 500px) {
            .welcome-features { grid-template-columns: 1fr; }
            .welcome-title { font-size: 26px; }
        }

        /* ---- Page ---- */
        .page { max-width: 1160px; margin: 0 auto; padding: 28px 22px 72px; }

        /* ---- Hero card ---- */
        .hero-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 28px 32px;
            margin-bottom: 18px;
            box-shadow: var(--shadow-sm);
            display: flex; align-items: center; gap: 32px;
            position: relative; overflow: hidden;
        }
        .hero-card::before {
            content: '';
            position: absolute; top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, var(--accent) 0%, var(--blue) 100%);
        }
        .hero-value-block { flex-shrink: 0; }
        .hero-label {
            font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1px; color: var(--text-muted);
            margin-bottom: 6px; display: flex; align-items: center; gap: 6px;
        }
        .hero-number {
            font-size: 60px; font-weight: 900; line-height: 1;
            letter-spacing: -3px; min-width: 120px;
        }
        .hero-number.positive   { color: var(--fresh); }
        .hero-number.neutral    { color: var(--neutral-clr); }
        .hero-number.negative-ok   { color: var(--blue); }
        .hero-number.negative-risk { color: var(--fatigued); }
        .hero-divider { width: 1px; height: 70px; background: var(--border); flex-shrink: 0; }
        .hero-status { flex: 1; }
        .hero-status-badge {
            display: inline-flex; align-items: center; gap: 6px;
            font-size: 13px; font-weight: 700;
            padding: 5px 14px; border-radius: 20px; margin-bottom: 10px;
        }
        .hero-status-badge.fresh   { background: var(--fresh-bg); color: var(--fresh-text); }
        .hero-status-badge.neutral { background: var(--neutral-bg); color: var(--neutral-text); }
        .hero-status-badge.fatigued { background: var(--fatigued-bg); color: var(--fatigued-text); }
        .hero-message { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 6px; }
        .hero-sub { font-size: 13px; color: var(--text-secondary); line-height: 1.65; }

        /* ---- Metric sections ---- */
        /* ---- Metrics master grid (shared 12-col track) ---- */
        .metrics-master {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            column-gap: 14px;
            row-gap: 14px;
            margin-bottom: 24px;
            align-items: stretch;
        }
        .metrics-section-label {
            grid-column: 1 / -1;
            font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1.2px; color: var(--text-muted);
            padding-left: 2px; margin-bottom: 0;
        }
        .metrics-section-label:not(:first-child) { margin-top: 6px; }
        .metric-card.span-4 { grid-column: span 4; }
        .metric-card.span-3 { grid-column: span 3; }
        .metric-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px 20px 18px;
            box-shadow: var(--shadow-sm);
            transition: box-shadow .15s, transform .15s;
            display: flex; flex-direction: column;
        }
        .metric-card:hover { box-shadow: var(--shadow-md); transform: translateY(-1px); }
        .metric-label {
            font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.8px; color: var(--text-muted);
            margin-bottom: 8px; display: flex; align-items: center; gap: 5px;
        }
        .metric-value { font-size: 30px; font-weight: 800; line-height: 1.1; letter-spacing: -0.8px; }
        .metric-unit { font-size: 13px; font-weight: 500; color: var(--text-muted); }
        .metric-explain {
            font-size: 12px; color: var(--text-secondary);
            margin-top: auto; padding-top: 10px; line-height: 1.6;
            border-top: 1px solid var(--border);
        }
        .badge {
            display: inline-flex; align-items: center;
            font-size: 11px; font-weight: 700;
            padding: 3px 10px; border-radius: 20px; margin-top: 8px;
        }
        .badge.fresh   { background: var(--fresh-bg); color: var(--fresh-text); }
        .badge.neutral { background: var(--neutral-bg); color: var(--neutral-text); }
        .badge.fatigued { background: var(--fatigued-bg); color: var(--fatigued-text); }
        .badge.demo-badge { background: #F0F1F3; color: #6B7280; }
        .badge.strava-badge { background: #FFF2E6; color: #994400; }

        /* ---- Tooltip ---- */
        .tip-wrap { position: relative; display: inline-flex; align-items: center; }
        .tip-icon {
            width: 14px; height: 14px; border-radius: 50%;
            background: var(--border); color: var(--text-muted);
            font-size: 9px; font-weight: 700;
            display: inline-flex; align-items: center; justify-content: center;
            cursor: help; font-style: normal; flex-shrink: 0;
            line-height: 1;
        }
        .tip-box {
            position: absolute; bottom: calc(100% + 7px);
            left: 50%; transform: translateX(-50%);
            background: #1A1D23; color: #F9FAFB;
            font-size: 11px; font-weight: 400; font-style: normal;
            padding: 7px 10px; border-radius: 8px;
            width: 210px; text-align: left; line-height: 1.55;
            pointer-events: none; opacity: 0; transition: opacity .18s;
            z-index: 200; box-shadow: 0 6px 18px rgba(0,0,0,.22);
        }
        .tip-box::after {
            content: ''; position: absolute; top: 100%; left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent; border-top-color: #1A1D23;
        }
        .tip-wrap:hover .tip-box { opacity: 1; }
        /* Keep tooltips inside viewport on edge cards */
        .metric-card.span-4:first-of-type .tip-box,
        .metric-card.span-3:last-child .tip-box ~ .tip-box { left: 0; transform: none; }
        .metric-card:last-child .tip-box { left: auto; right: 0; transform: none; }
        .metric-card:last-child .tip-box::after { left: auto; right: 12px; transform: none; }

        /* ---- Chart ---- */
        .chart-card {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: var(--radius-lg); padding: 24px 28px;
            margin-bottom: 18px; box-shadow: var(--shadow-sm);
        }
        .section-header { display: flex; align-items: baseline; gap: 10px; margin-bottom: 18px; }
        .section-title { font-size: 16px; font-weight: 700; }
        .section-sub { font-size: 12px; color: var(--text-muted); }
        .chart-card svg { width: 100%; height: auto; }
        .chart-legend { display: flex; gap: 22px; margin-top: 14px; flex-wrap: wrap; }
        .chart-legend span { font-size: 12px; color: var(--text-secondary); display: flex; align-items: center; gap: 6px; }
        .chart-legend .swatch { width: 18px; height: 4px; border-radius: 2px; flex-shrink: 0; }
        .chart-legend .swatch-dashed { width: 18px; height: 0; border-top: 3px dashed; border-radius: 0; flex-shrink: 0; }

        /* ---- Two-column layout ---- */
        .layout { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; align-items: start; }
        .card {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: var(--radius-lg); padding: 28px;
            box-shadow: var(--shadow-sm);
        }
        .card-title { font-size: 16px; font-weight: 700; margin-bottom: 22px; display: flex; align-items: center; gap: 8px; }
        .title-icon { font-size: 18px; }

        /* ---- Form ---- */
        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; }
        .slider-row { display: flex; align-items: center; gap: 12px; }
        .slider-row input[type="range"] {
            flex: 1; -webkit-appearance: none; height: 6px;
            border-radius: 3px; background: var(--border); outline: none;
        }
        .slider-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 20px; height: 20px;
            background: var(--accent); border-radius: 50%; cursor: pointer;
            box-shadow: 0 2px 6px rgba(252,76,2,.35);
            transition: transform .1s;
        }
        .slider-row input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.15); }
        .slider-val { font-size: 14px; font-weight: 700; color: var(--text); min-width: 40px; text-align: right; }
        .form-group input[type="number"],
        .form-group select {
            width: 100%; padding: 10px 14px;
            border: 1.5px solid var(--border); border-radius: var(--radius-sm);
            font-size: 14px; color: var(--text); background: var(--bg);
            font-family: 'Inter', sans-serif;
            transition: border-color .15s;
        }
        .form-group input[type="number"]:focus,
        .form-group select:focus {
            outline: none; border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(252,76,2,.1);
        }
        .hint { font-size: 11px; color: var(--text-muted); margin-top: 5px; }
        .btn-row { display: flex; flex-direction: column; gap: 10px; margin-top: 22px; }
        .btn {
            width: 100%; padding: 12px 18px; cursor: pointer; border: none;
            border-radius: var(--radius-sm); font-size: 14px; font-weight: 600;
            font-family: 'Inter', sans-serif; transition: all .15s; text-align: center;
        }
        .btn-primary { background: var(--accent); color: #fff; border: none; }
        .btn-primary:hover {
            background: var(--accent-dark); transform: translateY(-1px);
            box-shadow: 0 4px 14px rgba(252,76,2,.3);
        }
        .btn-ghost {
            background: transparent; color: var(--text-muted);
            border: none; font-size: 13px; font-weight: 500;
            text-decoration: underline; text-underline-offset: 3px;
        }
        .btn-ghost:hover { color: var(--text-secondary); }

        /* ---- Workout Prescription ---- */
        .workout-empty { color: var(--text-muted); font-size: 14px; text-align: center; padding: 44px 16px; }
        .workout-empty .empty-icon { font-size: 42px; margin-bottom: 12px; }
        .workout-empty p { line-height: 1.7; }
        .error { background: var(--fatigued-bg); border: 1px solid #FCA5A5; padding: 14px 18px; border-radius: var(--radius-sm); margin-bottom: 16px; font-size: 14px; }
        .error strong { color: var(--fatigued); }
        .workout-section { margin-bottom: 18px; padding-bottom: 18px; border-bottom: 1px solid var(--border); }
        .workout-section:last-of-type { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .ws-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .ws-icon { font-size: 15px; }
        .ws-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; color: var(--blue); }
        .workout-section p { font-size: 14px; line-height: 1.75; color: var(--text); }
        .reasoning-block {
            background: var(--blue-light);
            border-left: 3px solid var(--blue);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            padding: 18px 20px; margin-top: 18px;
        }
        .reasoning-block .ws-label { color: var(--blue-dark); }
        .reasoning-block p { font-size: 13px; line-height: 1.75; color: var(--text-secondary); }
        .generated-at { font-size: 11px; color: var(--text-muted); margin-top: 14px; }

        /* ---- Method disclosure ---- */
        .method-disclosure { margin-top: 36px; }
        .method-disclosure summary {
            list-style: none; cursor: pointer;
            font-size: 13px; color: var(--text-muted); font-weight: 500;
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 2px; user-select: none;
        }
        .method-disclosure summary::-webkit-details-marker { display: none; }
        .method-disclosure summary:hover { color: var(--text-secondary); }
        .method-disclosure .chevron {
            transition: transform .25s ease;
            display: inline-flex; align-items: center;
        }
        .method-disclosure[open] .chevron { transform: rotate(180deg); }
        .method-body-wrap {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: var(--radius-lg); padding: 26px 30px; margin-top: 12px;
            box-shadow: var(--shadow-sm);
        }
        .method-body-wrap h3 { font-size: 15px; font-weight: 700; margin-bottom: 16px; }
        .method-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 16px; }
        .method-cols p { font-size: 13px; color: var(--text-secondary); line-height: 1.7; }
        .method-cols p + p { margin-top: 8px; }
        .method-formula {
            background: var(--bg); border-radius: var(--radius-sm);
            padding: 14px 16px;
            font-family: "SF Mono", SFMono-Regular, "Cascadia Code", Consolas, monospace;
            font-size: 12px; color: var(--text); text-align: center; line-height: 2.2;
        }

        /* ---- Responsive ---- */
        @media (max-width: 960px) {
            /* 4 training signals cards wrap to 2Ã—2 */
            .metric-card.span-3 { grid-column: span 6; }
            .hero-card { flex-wrap: wrap; gap: 20px; }
            .hero-sub { max-width: none; }
        }
        @media (max-width: 700px) {
            /* all cards drop to 2-col */
            .metric-card.span-4,
            .metric-card.span-3 { grid-column: span 6; }
            .layout { grid-template-columns: 1fr; }
            .hero-card { flex-direction: column; gap: 16px; align-items: flex-start; }
            .hero-divider { display: none; }
            .hero-number { font-size: 48px; }
            .topbar { padding: 0 16px; }
            .page { padding: 18px 14px 56px; }
            .method-cols { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<!-- Topbar -->
<header class="topbar">
    <div class="topbar-brand">
        <div class="brand-icon">EC</div>
        <span class="brand-name">Enduro Coach</span>
    </div>
    <div class="topbar-right">
        {{stravaBar}}
    </div>
</header>

<div class="page">

{{dashboardContent}}

<!-- DASHBOARD_START -->

<!-- Readiness Hero -->
<div class="hero-card">
    <div class="hero-value-block">
        <div class="hero-label">
            Readiness
            <span class="tip-wrap">
                <i class="tip-icon">i</i>
                <span class="tip-box">Training Stress Balance (CTL &minus; ATL). Positive = fresh; negative during a build block is normal and productive.</span>
            </span>
        </div>
        <div class="hero-number {{tsbHeroClass}}">{{tsb}}</div>
    </div>
    <div class="hero-divider"></div>
    <div class="hero-status">
        {{tsbHeroStatusBadge}}
        <div class="hero-message">{{tsbHeroMessage}}</div>
        <div class="hero-sub">{{tsbExplain}}</div>
    </div>
</div>

<!-- Metrics: shared 12-col grid so both rows align perfectly -->
<div class="metrics-master">

    <div class="metrics-section-label">Your Status</div>

    <div class="metric-card span-4">
        <div class="metric-label">
            Fitness
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Chronic Training Load (CTL) &mdash; 42-day EMA of daily TRIMP. Your aerobic fitness base built over weeks of consistent training.</span></span>
        </div>
        <div class="metric-value">{{ctl}}</div>
        {{ctlBadge}}
        <div class="metric-explain">{{ctlExplain}}</div>
    </div>
    <div class="metric-card span-4">
        <div class="metric-label">
            Fatigue
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Acute Training Load (ATL) &mdash; 7-day EMA of daily TRIMP. Recent training stress; rises fast and fades fast.</span></span>
        </div>
        <div class="metric-value">{{atl}}</div>
        {{atlBadge}}
        <div class="metric-explain">{{atlExplain}}</div>
    </div>
    <div class="metric-card span-4">
        <div class="metric-label">
            Load Risk
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Acute:Chronic Workload Ratio (ACWR) &mdash; Gabbett (2016). Sweet spot 0.8&ndash;1.3. Above 1.5 = elevated injury risk.</span></span>
        </div>
        <div class="metric-value">{{acwr}}</div>
        {{acwrBadge}}
        <div class="metric-explain">{{acwrExplain}}</div>
    </div>

    <div class="metrics-section-label">Training Signals</div>

    <div class="metric-card span-3">
        <div class="metric-label">
            Variety
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Training Monotony &mdash; Foster (1998). Mean &divide; SD of 7-day daily loads. Above 2.0 = day-to-day load is too uniform.</span></span>
        </div>
        <div class="metric-value">{{monotony}}</div>
        {{monotonyBadge}}
        <div class="metric-explain">{{monotonyExplain}}</div>
    </div>
    <div class="metric-card span-3">
        <div class="metric-label">
            Weekly Load
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Total training minutes across the last 7 days. All connected cardio activity types are included.</span></span>
        </div>
        <div class="metric-value">{{volume}}<span class="metric-unit"> min</span></div>
        {{volumeBadge}}
        <div class="metric-explain">{{volumeExplain}}</div>
    </div>
    <div class="metric-card span-3">
        <div class="metric-label">
            Recent Spike
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">10-day load ratio: 10-day rolling total &divide; (10 &times; full-window average daily TRIMP). Catches short-term surges even when the 42/7-day ACWR looks safe.</span></span>
        </div>
        <div class="metric-value">{{spike10}}</div>
        {{spike10Badge}}
        <div class="metric-explain">{{spike10Explain}}</div>
    </div>
    <div class="metric-card span-3">
        <div class="metric-label">
            10-day Strain
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Foster strain over 10 days: mean load &times; monotony. Captures accumulated fatigue from both volume and lack of variation over the recent block.</span></span>
        </div>
        <div class="metric-value">{{strain10}}</div>
        {{strain10Badge}}
        <div class="metric-explain">{{strain10Explain}}</div>
    </div>

</div>

<!-- Training Load Chart -->
<div class="chart-card">
    <div class="section-header">
        <span class="section-title">Training Load History</span>
        <span class="section-sub">{{source}} {{sourceBadge}}</span>
    </div>
    {{loadChart}}
    <div class="chart-legend">
        <span><span class="swatch" style="background:#1A73E8;"></span> Fitness (CTL)</span>
        <span><span class="swatch" style="background:#FC4C02;"></span> Fatigue (ATL)</span>
        <span><span class="swatch-dashed" style="color:#059669;"></span> Readiness (TSB)</span>
    </div>
</div>

<!-- Check-in & Prescription -->
<div class="layout">

    <div class="card">
        <div class="card-title"><span class="title-icon">&#x1F3CB;</span> Today's Check-in</div>
        <form action="/dashboard/checkin" method="post">
            <div class="form-group">
                <label>How do your legs feel?</label>
                <div class="slider-row">
                    <input type="range" name="legFeeling" min="1" max="10" value="{{legFeeling}}"
                           oninput="this.parentNode.querySelector('.slider-val').textContent=this.value+'/10'" />
                    <span class="slider-val">{{legFeeling}}/10</span>
                </div>
                <div class="hint">1 = very heavy &nbsp;&middot;&nbsp; 10 = spring in your step</div>
            </div>
            <div class="form-group">
                <label>Mental energy</label>
                <div class="slider-row">
                    <input type="range" name="mentalReadiness" min="1" max="10" value="{{mentalReadiness}}"
                           oninput="this.parentNode.querySelector('.slider-val').textContent=this.value+'/10'" />
                    <span class="slider-val">{{mentalReadiness}}/10</span>
                </div>
                <div class="hint">1 = flat / unmotivated &nbsp;&middot;&nbsp; 10 = fired up</div>
            </div>
            <div class="form-group">
                <label>Time available (minutes)</label>
                <input type="number" name="timeAvailableMinutes" min="15" max="240" value="{{timeAvailableMinutes}}" />
                <div class="hint">How much time do you have for today's session?</div>
            </div>
            <div class="form-group">
                <label>Coaching approach</label>
                <select name="coachingPhilosophy">{{philosophyOptions}}</select>
                <div class="hint">Controls risk tolerance and intensity bias in the prescription</div>
            </div>
            <div class="btn-row">
                <button class="btn btn-primary" type="submit" formaction="/dashboard/generate">Get today's session &#x2192;</button>
                <button class="btn btn-ghost" type="submit">Save check-in only</button>
            </div>
        </form>
    </div>

    <div class="card">
        <div class="card-title"><span class="title-icon">&#x26A1;</span> Today's Session</div>
        {{errorCard}}
        {{workoutCard}}
    </div>

</div>

<!-- Method disclosure -->
<details class="method-disclosure">
    <summary><span class="chevron"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 4.5L6 8L9.5 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span> About the training science</summary>
    <div class="method-body-wrap">
        <h3>The Banister Impulse-Response Model</h3>
        <div class="method-cols">
            <div>
                <p>Developed by <strong>Eric Banister</strong> in the 1970s&ndash;80s, the impulse-response model treats each training session as an <em>impulse</em> that creates two competing biological responses: a <strong>fitness gain</strong> (slow-building, long-lasting) and a <strong>fatigue cost</strong> (fast-building, fast-decaying). Your readiness at any moment is the net difference between the two.</p>
                <p>Extended with <strong>Tim Gabbett&rsquo;s ACWR</strong> for injury risk management and <strong>Carl Foster&rsquo;s training monotony</strong> for load variation. Intensity is quantified using zone-weighted TRIMP (Lucia et al. 2003) &mdash; a heart-rate-reserve measure that avoids over-penalising moderate aerobic work.</p>
            </div>
            <div>
                <p><strong>Fitness (CTL)</strong> &mdash; 42-day EMA of daily TRIMP. Your aerobic base built over sustained training.</p>
                <p><strong>Fatigue (ATL)</strong> &mdash; 7-day EMA. Recent stress; rises fast and falls fast.</p>
                <p><strong>Readiness (TSB)</strong> &mdash; CTL &minus; ATL. Negative during a build block is perfectly normal and productive. Race-ready zone: +10 to +25.</p>
                <p><strong>Load Risk (ACWR)</strong> &mdash; ATL / CTL. Sweet spot 0.8&ndash;1.3. Above 1.5 = elevated injury risk per Gabbett (2016).</p>
                <p><strong>Recent Spike &amp; 10-day Strain</strong> &mdash; Supplement ACWR by flagging short-window load surges and accumulated load &times; monotony over the last 10 days.</p>
            </div>
        </div>
        <div class="method-formula">
            TRIMP = duration &times; %HRR &times; zone-weight
            &nbsp;&nbsp;|&nbsp;&nbsp;
            CTL<sub>t</sub> = CTL<sub>t&minus;1</sub> + (TRIMP &minus; CTL<sub>t&minus;1</sub>) / 42
            &nbsp;&nbsp;|&nbsp;&nbsp;
            TSB = CTL &minus; ATL
            &nbsp;&nbsp;|&nbsp;&nbsp;
            ACWR = ATL / CTL
        </div>
    </div>
</details>

<!-- DASHBOARD_END -->

</div><!-- /page -->
</body>
</html>
