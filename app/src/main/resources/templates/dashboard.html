<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enduro Coach</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
    <style>
        :root {
            --bg: #070B14;
            --bg-soft: #0D1220;
            --surface: #121A2B;
            --surface-2: #182238;
            --surface-3: #1C2942;
            --border: #27344D;
            --border-strong: #324362;
            --text: #F4F8FF;
            --text-secondary: #A8B6CF;
            --text-muted: #8191AD;
            --accent: #6D79FF;
            --accent-2: #15B6FF;
            --accent-warm: #FC4C02;
            --fresh: #22C38E;
            --fresh-bg: rgba(34, 195, 142, .14);
            --fresh-text: #7CF0C2;
            --neutral-clr: #F7B955;
            --neutral-bg: rgba(247, 185, 85, .14);
            --neutral-text: #FFD99A;
            --fatigued: #FF6C7E;
            --fatigued-bg: rgba(255, 108, 126, .14);
            --fatigued-text: #FFB3BF;
            --radius-lg: 18px;
            --radius-md: 12px;
            --radius-sm: 10px;
            --shadow-sm: 0 6px 24px rgba(0, 0, 0, .28);
            --shadow-md: 0 12px 40px rgba(0, 0, 0, .35);
            --topbar-h: 68px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { min-height: 100%; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: var(--text);
            line-height: 1.5;
            background:
                radial-gradient(1000px 600px at 10% -10%, rgba(109, 121, 255, .22), transparent 65%),
                radial-gradient(900px 560px at 110% -5%, rgba(21, 182, 255, .16), transparent 62%),
                linear-gradient(180deg, #09101D 0%, var(--bg) 55%, #050910 100%);
        }

        .topbar {
            position: sticky;
            top: 12px;
            z-index: 100;
            max-width: 1240px;
            margin: 12px auto 0;
            height: var(--topbar-h);
            border-radius: 16px;
            display: flex;
            align-items: center;
            padding: 0 22px;
            gap: 16px;
            background: rgba(14, 22, 38, .72);
            border: 1px solid rgba(131, 155, 199, .18);
            backdrop-filter: blur(14px);
            box-shadow: 0 8px 34px rgba(0, 0, 0, .35);
        }
        .topbar-brand { display: flex; align-items: center; gap: 12px; flex: 1; }
        .brand-icon {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 13px;
            font-weight: 900;
            letter-spacing: -.3px;
            box-shadow: 0 8px 20px rgba(109, 121, 255, .45);
        }
        .brand-name { font-size: 15px; font-weight: 700; letter-spacing: .2px; }
        .topbar-right { display: flex; align-items: center; gap: 12px; }
        .strava-status {
            display: flex;
            align-items: center;
            gap: 7px;
            font-size: 12px;
            color: var(--text-secondary);
            padding: 7px 11px;
            border-radius: 999px;
            background: rgba(124, 140, 173, .12);
            border: 1px solid rgba(124, 140, 173, .22);
        }
        .dot { width: 8px; height: 8px; border-radius: 999px; flex-shrink: 0; }
        .dot.connected { background: var(--fresh); box-shadow: 0 0 0 4px rgba(34, 195, 142, .17); }
        .dot.disconnected { background: #8A95AB; }
        .btn-connect {
            display: inline-flex;
            align-items: center;
            white-space: nowrap;
            text-decoration: none;
            font-size: 12px;
            font-weight: 700;
            color: #fff;
            padding: 9px 14px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
            box-shadow: 0 10px 24px rgba(33, 113, 255, .34);
            transition: transform .15s ease, box-shadow .15s ease;
        }
        .btn-connect:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 28px rgba(33, 113, 255, .44);
        }
        .btn-disconnect {
            text-decoration: none;
            font-size: 12px;
            color: var(--text-muted);
            padding: 7px 10px;
            border-radius: 9px;
            border: 1px solid rgba(124, 140, 173, .25);
            background: rgba(18, 26, 43, .8);
            transition: color .15s ease, border-color .15s ease;
        }
        .btn-disconnect:hover { color: var(--fatigued-text); border-color: rgba(255, 108, 126, .45); }

        .page { max-width: 1240px; margin: 0 auto; padding: 22px 20px 72px; }

        .welcome-hero {
            max-width: 720px;
            margin: 10px auto 0;
            padding: 58px 28px;
            text-align: center;
            border-radius: 22px;
            border: 1px solid rgba(131, 155, 199, .18);
            background:
                linear-gradient(165deg, rgba(109, 121, 255, .13), rgba(21, 182, 255, .06) 55%, rgba(14, 22, 38, .75) 95%),
                var(--surface);
            box-shadow: var(--shadow-md);
        }
        .welcome-icon {
            width: 72px;
            height: 72px;
            margin: 0 auto 24px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 900;
            color: #fff;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
            box-shadow: 0 14px 34px rgba(81, 113, 255, .45);
        }
        .welcome-title { font-size: 40px; font-weight: 900; letter-spacing: -.03em; margin-bottom: 12px; }
        .welcome-sub { font-size: 15px; color: var(--text-secondary); line-height: 1.75; margin-bottom: 28px; }
        .welcome-cta {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: #fff;
            font-size: 15px;
            font-weight: 700;
            padding: 13px 26px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
            transition: transform .16s ease, box-shadow .16s ease;
            box-shadow: 0 14px 30px rgba(71, 109, 255, .42);
        }
        .welcome-cta:hover { transform: translateY(-2px); box-shadow: 0 18px 34px rgba(71, 109, 255, .52); }
        .welcome-note {
            font-size: 13px;
            color: var(--text-secondary);
            background: rgba(124, 140, 173, .08);
            border: 1px solid rgba(124, 140, 173, .25);
            border-radius: 12px;
            padding: 14px 16px;
        }
        .welcome-note code {
            background: rgba(124, 140, 173, .2);
            color: var(--text);
            border-radius: 6px;
            padding: 2px 6px;
            font-size: 12px;
        }
        .welcome-features { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 30px; text-align: left; }
        .wf {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: var(--text-secondary);
            border-radius: 10px;
            padding: 11px 12px;
            border: 1px solid rgba(131, 155, 199, .2);
            background: rgba(18, 26, 43, .58);
        }
        .wf-icon { font-size: 15px; }

        .hero-card,
        .metric-card,
        .chart-card,
        .workouts-card,
        .card,
        .method-body-wrap {
            background: linear-gradient(170deg, rgba(121, 143, 186, .06), rgba(121, 143, 186, .02) 22%, rgba(18, 26, 43, .96) 70%), var(--surface);
            border: 1px solid rgba(131, 155, 199, .18);
            box-shadow: var(--shadow-sm);
        }

        .hero-card {
            border-radius: var(--radius-lg);
            padding: 28px 30px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 30px;
            position: relative;
            overflow: hidden;
        }
        .hero-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-2) 100%);
        }
        .hero-value-block { flex-shrink: 0; }
        .hero-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.1px;
            color: var(--text-muted);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .hero-number { font-size: 66px; font-weight: 900; line-height: 1; letter-spacing: -.05em; min-width: 136px; }
        .hero-number.positive { color: var(--fresh); }
        .hero-number.neutral { color: var(--neutral-clr); }
        .hero-number.negative-ok { color: var(--accent-2); }
        .hero-number.negative-risk { color: var(--fatigued); }
        .hero-divider { width: 1px; height: 72px; background: rgba(131, 155, 199, .22); flex-shrink: 0; }
        .hero-status { flex: 1; }
        .hero-status-badge {
            display: inline-flex;
            align-items: center;
            font-size: 11px;
            font-weight: 700;
            padding: 6px 11px;
            border-radius: 999px;
            margin-bottom: 10px;
            letter-spacing: .3px;
            border: 1px solid transparent;
        }
        .hero-status-badge.fresh { background: var(--fresh-bg); color: var(--fresh-text); border-color: rgba(124, 240, 194, .25); }
        .hero-status-badge.neutral { background: var(--neutral-bg); color: var(--neutral-text); border-color: rgba(255, 217, 154, .25); }
        .hero-status-badge.fatigued { background: var(--fatigued-bg); color: var(--fatigued-text); border-color: rgba(255, 179, 191, .25); }
        .hero-message { font-size: 17px; font-weight: 700; margin-bottom: 6px; }
        .hero-sub { font-size: 13px; color: var(--text-secondary); line-height: 1.7; }

        .metrics-master {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            column-gap: 14px;
            row-gap: 14px;
            margin-bottom: 20px;
            align-items: stretch;
        }
        .metrics-section-label {
            grid-column: 1 / -1;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: var(--text-muted);
            margin: 2px 0 0;
            padding-left: 2px;
        }
        .metrics-section-label:not(:first-child) { margin-top: 6px; }
        .metric-card.span-4 { grid-column: span 4; }
        .metric-card.span-3 { grid-column: span 3; }
        .metric-card {
            border-radius: var(--radius-lg);
            padding: 18px;
            transition: border-color .16s ease, transform .16s ease, box-shadow .16s ease;
            display: flex;
            flex-direction: column;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            border-color: rgba(129, 145, 173, .36);
            box-shadow: 0 14px 34px rgba(0, 0, 0, .35);
        }
        .metric-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: .95px;
            color: var(--text-muted);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .metric-value { font-size: 31px; font-weight: 800; letter-spacing: -.03em; line-height: 1.05; }
        .metric-unit { font-size: 12px; color: var(--text-muted); margin-left: 2px; }
        .metric-explain {
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px solid rgba(131, 155, 199, .2);
            color: var(--text-secondary);
            font-size: 12px;
            line-height: 1.63;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
            padding: 5px 9px;
            border-radius: 999px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: .3px;
            border: 1px solid transparent;
        }
        .badge.fresh { background: var(--fresh-bg); color: var(--fresh-text); border-color: rgba(124, 240, 194, .26); }
        .badge.neutral { background: var(--neutral-bg); color: var(--neutral-text); border-color: rgba(255, 217, 154, .28); }
        .badge.fatigued { background: var(--fatigued-bg); color: var(--fatigued-text); border-color: rgba(255, 179, 191, .3); }
        .badge.demo-badge { background: rgba(124, 140, 173, .15); color: #C3CEE1; border-color: rgba(124, 140, 173, .26); }
        .badge.strava-badge { background: rgba(252, 76, 2, .15); color: #FFB58E; border-color: rgba(252, 76, 2, .35); }

        .tip-wrap { position: relative; display: inline-flex; align-items: center; }
        .tip-icon {
            width: 14px;
            height: 14px;
            border-radius: 999px;
            background: rgba(131, 155, 199, .2);
            color: #D4DDF0;
            font-size: 9px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        .tip-box {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            width: 214px;
            font-size: 11px;
            line-height: 1.55;
            color: #EAF1FF;
            background: #0B1220;
            border: 1px solid rgba(131, 155, 199, .28);
            border-radius: 10px;
            padding: 8px 10px;
            opacity: 0;
            pointer-events: none;
            transition: opacity .16s ease;
            z-index: 20;
            box-shadow: 0 16px 30px rgba(0, 0, 0, .45);
        }
        .tip-box::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #0B1220;
        }
        .tip-wrap:hover .tip-box { opacity: 1; }

        .workouts-card,
        .chart-card,
        .card,
        .method-body-wrap {
            border-radius: var(--radius-lg);
            padding: 22px 24px;
            margin-bottom: 16px;
        }
        .section-header { display: flex; align-items: baseline; justify-content: space-between; gap: 12px; margin-bottom: 16px; }
        .section-title { font-size: 16px; font-weight: 700; letter-spacing: -.01em; }
        .section-sub { font-size: 12px; color: var(--text-muted); }

        .workouts-scroll {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            overflow-y: hidden;
            padding-bottom: 8px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }
        .workouts-scroll::-webkit-scrollbar { height: 6px; }
        .workouts-scroll::-webkit-scrollbar-track { background: rgba(124, 140, 173, .12); border-radius: 999px; }
        .workouts-scroll::-webkit-scrollbar-thumb { background: rgba(124, 140, 173, .34); border-radius: 999px; }
        .workout-item {
            flex: 0 0 230px;
            scroll-snap-align: start;
            border-radius: 12px;
            border: 1px solid rgba(131, 155, 199, .2);
            background: linear-gradient(165deg, rgba(121, 143, 186, .08), rgba(14, 22, 38, .96));
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: transform .16s ease, border-color .16s ease;
        }
        .workout-item:hover { transform: translateY(-2px); border-color: rgba(131, 155, 199, .36); }
        .wi-header { display: flex; align-items: center; gap: 8px; }
        .wi-type-icon { font-size: 17px; }
        .wi-name { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .wi-date { font-size: 11px; color: var(--text-muted); }
        .wi-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .wi-stat-label { font-size: 10px; text-transform: uppercase; letter-spacing: .55px; color: var(--text-muted); }
        .wi-stat-value { font-size: 12px; font-weight: 700; color: #E5EDFF; }
        .wi-trimp-row { display: flex; align-items: center; gap: 7px; margin-top: 2px; }
        .wi-trimp-bar { flex: 1; height: 5px; border-radius: 999px; background: rgba(131, 155, 199, .23); overflow: hidden; }
        .wi-trimp-fill { height: 100%; border-radius: 999px; }
        .wi-trimp-val { min-width: 28px; text-align: right; font-size: 11px; font-weight: 700; }
        .workouts-empty { color: var(--text-secondary); text-align: center; font-size: 13px; padding: 24px 12px; }

        .chart-card svg { width: 100%; height: auto; }
        .chart-legend { display: flex; gap: 20px; flex-wrap: wrap; margin-top: 12px; }
        .chart-legend span { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary); }
        .chart-legend .swatch { width: 18px; height: 4px; border-radius: 3px; }
        .chart-legend .swatch-dashed { width: 18px; height: 0; border-top: 3px dashed; }

        .layout { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start; }
        .card-title { font-size: 16px; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }
        .title-icon { font-size: 17px; }

        .form-group { margin-bottom: 17px; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 600; color: #D3DDF1; }
        .slider-row { display: flex; align-items: center; gap: 10px; }
        .slider-row input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 999px;
            background: rgba(124, 140, 173, .3);
            outline: none;
        }
        .slider-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
            box-shadow: 0 8px 16px rgba(57, 113, 255, .45);
            cursor: pointer;
            transition: transform .15s ease;
        }
        .slider-row input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.1); }
        .slider-val { min-width: 42px; text-align: right; font-size: 13px; font-weight: 700; }
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 11px 13px;
            border-radius: 10px;
            border: 1px solid rgba(131, 155, 199, .3);
            color: var(--text);
            background: rgba(14, 22, 38, .9);
            font-size: 14px;
            font-family: 'Inter', sans-serif;
        }
        .form-group input[type="number"]:focus,
        .form-group select:focus {
            outline: none;
            border-color: rgba(109, 121, 255, .75);
            box-shadow: 0 0 0 3px rgba(109, 121, 255, .18);
        }
        .hint { font-size: 11px; color: var(--text-muted); margin-top: 5px; }
        .btn-row { margin-top: 20px; display: flex; flex-direction: column; gap: 9px; }
        .btn {
            width: 100%;
            border: none;
            border-radius: 10px;
            padding: 12px 16px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: transform .15s ease, box-shadow .15s ease;
        }
        .btn-primary {
            color: #fff;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
            box-shadow: 0 10px 24px rgba(57, 113, 255, .38);
        }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 14px 28px rgba(57, 113, 255, .46); }
        .btn-ghost {
            background: rgba(124, 140, 173, .12);
            color: var(--text-secondary);
            border: 1px solid rgba(124, 140, 173, .26);
        }
        .btn-ghost:hover { color: var(--text); border-color: rgba(124, 140, 173, .38); }

        .workout-empty { color: var(--text-secondary); font-size: 14px; text-align: center; padding: 40px 12px; }
        .workout-empty .empty-icon { font-size: 38px; margin-bottom: 11px; }
        .error {
            background: rgba(255, 108, 126, .14);
            border: 1px solid rgba(255, 108, 126, .36);
            border-radius: 10px;
            padding: 12px 14px;
            margin-bottom: 15px;
            font-size: 13px;
            color: var(--fatigued-text);
        }
        .workout-section { margin-bottom: 17px; padding-bottom: 17px; border-bottom: 1px solid rgba(131, 155, 199, .2); }
        .workout-section:last-of-type { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .ws-header { display: flex; align-items: center; gap: 8px; margin-bottom: 7px; }
        .ws-icon { font-size: 14px; }
        .ws-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; color: #9EB4FF; }
        .workout-section p { font-size: 14px; line-height: 1.72; color: #E4ECFF; }
        .reasoning-block {
            margin-top: 16px;
            padding: 16px 17px;
            border-radius: 10px;
            border: 1px solid rgba(109, 121, 255, .35);
            background: rgba(109, 121, 255, .12);
        }
        .reasoning-block .ws-label { color: #C8D6FF; }
        .reasoning-block p { color: #DAE4FA; font-size: 13px; line-height: 1.72; }
        .generated-at { margin-top: 12px; font-size: 11px; color: var(--text-muted); }

        .method-disclosure { margin-top: 28px; }
        .method-disclosure summary {
            list-style: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 500;
            padding: 7px 2px;
        }
        .method-disclosure summary::-webkit-details-marker { display: none; }
        .method-disclosure summary:hover { color: var(--text-secondary); }
        .method-disclosure .chevron { transition: transform .25s ease; display: inline-flex; align-items: center; }
        .method-disclosure[open] .chevron { transform: rotate(180deg); }
        .method-body-wrap { margin-top: 10px; }
        .method-body-wrap h3 { font-size: 15px; margin-bottom: 14px; }
        .method-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 22px; margin-bottom: 14px; }
        .method-cols p { font-size: 13px; line-height: 1.7; color: var(--text-secondary); }
        .method-cols p + p { margin-top: 8px; }
        .method-formula {
            border-radius: 10px;
            border: 1px solid rgba(131, 155, 199, .22);
            background: rgba(14, 22, 38, .85);
            padding: 13px 14px;
            text-align: center;
            color: #DCE7FF;
            line-height: 2;
            font-size: 12px;
            font-family: "SF Mono", SFMono-Regular, "Cascadia Code", Consolas, monospace;
        }

        @media (max-width: 960px) {
            .topbar { top: 10px; margin: 10px 12px 0; }
            .metric-card.span-3 { grid-column: span 6; }
            .hero-card { flex-wrap: wrap; gap: 20px; }
        }
        @media (max-width: 700px) {
            .page { padding: 16px 12px 56px; }
            .topbar { margin: 10px 10px 0; padding: 0 12px; }
            .welcome-title { font-size: 32px; }
            .welcome-features { grid-template-columns: 1fr; }
            .metric-card.span-4,
            .metric-card.span-3 { grid-column: span 6; }
            .layout { grid-template-columns: 1fr; }
            .hero-card { flex-direction: column; align-items: flex-start; gap: 14px; }
            .hero-divider { display: none; }
            .hero-number { font-size: 50px; min-width: 0; }
            .workout-item { flex-basis: 210px; }
            .method-cols { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<!-- Topbar -->
<header class="topbar">
    <div class="topbar-brand">
        <div class="brand-icon">EC</div>
        <span class="brand-name">Enduro Coach OS</span>
    </div>
    <div class="topbar-right">
        {{stravaBar}}
    </div>
</header>

<div class="page">

{{dashboardContent}}

<!-- DASHBOARD_START -->

<!-- Readiness Hero -->
<div class="hero-card">
    <div class="hero-value-block">
        <div class="hero-label">
            Readiness Signal
            <span class="tip-wrap">
                <i class="tip-icon">i</i>
                <span class="tip-box">Training Stress Balance (CTL &minus; ATL). Positive = fresh; negative during a build block is normal and productive.</span>
            </span>
        </div>
        <div class="hero-number {{tsbHeroClass}}">{{tsb}}</div>
    </div>
    <div class="hero-divider"></div>
    <div class="hero-status">
        {{tsbHeroStatusBadge}}
        <div class="hero-message">{{tsbHeroMessage}}</div>
        <div class="hero-sub">{{tsbExplain}}</div>
    </div>
</div>

<!-- Metrics: shared 12-col grid so both rows align perfectly -->
<div class="metrics-master">

    <div class="metrics-section-label">Performance Core</div>

    <div class="metric-card span-4">
        <div class="metric-label">
            Fitness
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Chronic Training Load (CTL) &mdash; 42-day EMA of daily TRIMP. Your aerobic fitness base built over weeks of consistent training.</span></span>
        </div>
        <div class="metric-value">{{ctl}}</div>
        {{ctlBadge}}
        <div class="metric-explain">{{ctlExplain}}</div>
    </div>
    <div class="metric-card span-4">
        <div class="metric-label">
            Fatigue
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Acute Training Load (ATL) &mdash; 7-day EMA of daily TRIMP. Recent training stress; rises fast and fades fast.</span></span>
        </div>
        <div class="metric-value">{{atl}}</div>
        {{atlBadge}}
        <div class="metric-explain">{{atlExplain}}</div>
    </div>
    <div class="metric-card span-4">
        <div class="metric-label">
            Load Risk
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Acute:Chronic Workload Ratio (ACWR) &mdash; Gabbett (2016). Sweet spot 0.8&ndash;1.3. Above 1.5 = elevated injury risk.</span></span>
        </div>
        <div class="metric-value">{{acwr}}</div>
        {{acwrBadge}}
        <div class="metric-explain">{{acwrExplain}}</div>
    </div>

    <div class="metrics-section-label">Risk Signals</div>

    <div class="metric-card span-3">
        <div class="metric-label">
            Variety
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Training Monotony &mdash; Foster (1998). Mean &divide; SD of 7-day daily loads. Above 2.0 = day-to-day load is too uniform.</span></span>
        </div>
        <div class="metric-value">{{monotony}}</div>
        {{monotonyBadge}}
        <div class="metric-explain">{{monotonyExplain}}</div>
    </div>
    <div class="metric-card span-3">
        <div class="metric-label">
            Weekly Load
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Total training minutes across the last 7 days. All connected cardio activity types are included.</span></span>
        </div>
        <div class="metric-value">{{volume}}<span class="metric-unit"> min</span></div>
        {{volumeBadge}}
        <div class="metric-explain">{{volumeExplain}}</div>
    </div>
    <div class="metric-card span-3">
        <div class="metric-label">
            Recent Spike
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">10-day load ratio: 10-day rolling total &divide; (10 &times; full-window average daily TRIMP). Catches short-term surges even when the 42/7-day ACWR looks safe.</span></span>
        </div>
        <div class="metric-value">{{spike10}}</div>
        {{spike10Badge}}
        <div class="metric-explain">{{spike10Explain}}</div>
    </div>
    <div class="metric-card span-3">
        <div class="metric-label">
            10-day Strain
            <span class="tip-wrap"><i class="tip-icon">i</i><span class="tip-box">Foster strain over 10 days: mean load &times; monotony. Captures accumulated fatigue from both volume and lack of variation over the recent block.</span></span>
        </div>
        <div class="metric-value">{{strain10}}</div>
        {{strain10Badge}}
        <div class="metric-explain">{{strain10Explain}}</div>
    </div>

</div>

<!-- Recent Workouts Strip -->
{{workoutsStrip}}

<!-- Training Load Chart -->
<div class="chart-card">
    <div class="section-header">
        <span class="section-title">Load Engine Timeline</span>
        <span class="section-sub">{{source}} {{sourceBadge}}</span>
    </div>
    {{loadChart}}
    <div class="chart-legend">
        <span><span class="swatch" style="background:#1A73E8;"></span> Fitness (CTL)</span>
        <span><span class="swatch" style="background:#FC4C02;"></span> Fatigue (ATL)</span>
        <span><span class="swatch-dashed" style="color:#059669;"></span> Readiness (TSB)</span>
    </div>
</div>

<!-- Check-in & Prescription -->
<div class="layout">

    <div class="card">
        <div class="card-title"><span class="title-icon">&#x1F3CB;</span> Daily Input</div>
        <form action="/dashboard/checkin" method="post">
            <div class="form-group">
                <label>How do your legs feel?</label>
                <div class="slider-row">
                    <input type="range" name="legFeeling" min="1" max="10" value="{{legFeeling}}"
                           oninput="this.parentNode.querySelector('.slider-val').textContent=this.value+'/10'" />
                    <span class="slider-val">{{legFeeling}}/10</span>
                </div>
                <div class="hint">1 = very heavy &nbsp;&middot;&nbsp; 10 = spring in your step</div>
            </div>
            <div class="form-group">
                <label>Mental energy</label>
                <div class="slider-row">
                    <input type="range" name="mentalReadiness" min="1" max="10" value="{{mentalReadiness}}"
                           oninput="this.parentNode.querySelector('.slider-val').textContent=this.value+'/10'" />
                    <span class="slider-val">{{mentalReadiness}}/10</span>
                </div>
                <div class="hint">1 = flat / unmotivated &nbsp;&middot;&nbsp; 10 = fired up</div>
            </div>
            <div class="form-group">
                <label>Time available (minutes)</label>
                <input type="number" name="timeAvailableMinutes" min="15" max="240" value="{{timeAvailableMinutes}}" />
                <div class="hint">How much time do you have for today's session?</div>
            </div>
            <div class="form-group">
                <label>Coaching approach</label>
                <select name="coachingPhilosophy">{{philosophyOptions}}</select>
                <div class="hint">Controls risk tolerance and intensity bias in the prescription</div>
            </div>
            <div class="btn-row">
                <button class="btn btn-primary" type="submit" formaction="/dashboard/generate">Generate session &#x2192;</button>
                <button class="btn btn-ghost" type="submit">Save check-in only</button>
            </div>
        </form>
    </div>

    <div class="card">
        <div class="card-title"><span class="title-icon">&#x26A1;</span> Coach Output</div>
        {{errorCard}}
        {{workoutCard}}
    </div>

</div>

<!-- Method disclosure -->
<details class="method-disclosure">
    <summary><span class="chevron"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 4.5L6 8L9.5 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span> Model + methodology</summary>
    <div class="method-body-wrap">
        <h3>The Banister Impulse-Response Model</h3>
        <div class="method-cols">
            <div>
                <p>Developed by <strong>Eric Banister</strong> in the 1970s&ndash;80s, the impulse-response model treats each training session as an <em>impulse</em> that creates two competing biological responses: a <strong>fitness gain</strong> (slow-building, long-lasting) and a <strong>fatigue cost</strong> (fast-building, fast-decaying). Your readiness at any moment is the net difference between the two.</p>
                <p>Extended with <strong>Tim Gabbett&rsquo;s ACWR</strong> for injury risk management and <strong>Carl Foster&rsquo;s training monotony</strong> for load variation. Intensity is quantified using zone-weighted TRIMP (Lucia et al. 2003) &mdash; a heart-rate-reserve measure that avoids over-penalising moderate aerobic work.</p>
            </div>
            <div>
                <p><strong>Fitness (CTL)</strong> &mdash; 42-day EMA of daily TRIMP. Your aerobic base built over sustained training.</p>
                <p><strong>Fatigue (ATL)</strong> &mdash; 7-day EMA. Recent stress; rises fast and falls fast.</p>
                <p><strong>Readiness (TSB)</strong> &mdash; CTL &minus; ATL. Negative during a build block is perfectly normal and productive. Race-ready zone: +10 to +25.</p>
                <p><strong>Load Risk (ACWR)</strong> &mdash; ATL / CTL. Sweet spot 0.8&ndash;1.3. Above 1.5 = elevated injury risk per Gabbett (2016).</p>
                <p><strong>Recent Spike &amp; 10-day Strain</strong> &mdash; Supplement ACWR by flagging short-window load surges and accumulated load &times; monotony over the last 10 days.</p>
            </div>
        </div>
        <div class="method-formula">
            TRIMP = duration &times; %HRR &times; zone-weight
            &nbsp;&nbsp;|&nbsp;&nbsp;
            CTL<sub>t</sub> = CTL<sub>t&minus;1</sub> + (TRIMP &minus; CTL<sub>t&minus;1</sub>) / 42
            &nbsp;&nbsp;|&nbsp;&nbsp;
            TSB = CTL &minus; ATL
            &nbsp;&nbsp;|&nbsp;&nbsp;
            ACWR = ATL / CTL
        </div>
    </div>
</details>

<!-- DASHBOARD_END -->

</div><!-- /page -->
</body>
</html>
